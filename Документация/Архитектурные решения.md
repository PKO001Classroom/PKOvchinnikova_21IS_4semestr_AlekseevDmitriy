# Архитектурное решение системы управления учебным процессом

---

## 1. Введение

**Система:** Веб-приложение для управления оценками в колледжах с учетом ФГОС СПО  
**Цель:** Автоматизация выставления, хранения и просмотра оценок с ролевым разделением (преподаватель/студент)  
**Подход:** Монолитная архитектура с серверным рендерингом для быстрой разработки

---

## 2. Технический стек (упрощенный)

### Бэкенд:
- **Python + Django** (или FastAPI для асинхронности)
- **PostgreSQL** для основной базы данных

### Фронтенд:
- **HTML/CSS/JavaScript** (ванильный, без сложных фреймворков)

### Инфраструктура:
- **Docker** для контейнеризации
- **Nginx** как веб-сервер
- **Git** для контроля версий

---

## 3. Архитектура системы

```
┌─────────────────────────────────────────────────┐
│             Веб-браузер пользователя            │
└─────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────┐
│               Nginx (веб-сервер)                 │
└─────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────┐
│             Django Application                   │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐       │
│  │  Views   │ │ Models   │ │ Templates│       │
│  └──────────┘ └──────────┘ └──────────┘       │
│  ┌───────────────────────────────────────┐     │
│  │         Бизнес-логика                 │     │
│  │  • Авторизация/роли                   │     │
│  │  • Оценки по ФГОС                     │     │
│  │  • Расчет средних баллов              │     │
│  │  • Проверка комментариев (100+ симв.)│     │
│  └───────────────────────────────────────┘     │
└─────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────┐
│              PostgreSQL                         │
│  • Пользователи, оценки, предметы              │
│  • Компетенции ФГОС, комментарии               │
└─────────────────────────────────────────────────┘
```

---

## 4. Структура проекта

```
edu_system/
├── manage.py
├── requirements.txt
├── docker-compose.yml
├── nginx/
│   └── nginx.conf
└── app/
    ├── __init__.py
    ├── settings.py
    ├── urls.py
    ├── wsgi.py
    ├── templates/           # HTML-шаблоны
    │   ├── base.html
    │   ├── auth/
    │   ├── student/
    │   └── teacher/
    ├── static/             # CSS, JS, изображения
    ├── models.py           # Модели базы данных
    ├── views.py            # Обработчики запросов
    ├── forms.py            # Формы Django
    ├── utils/              # Вспомогательные функции
    │   ├── fgos_calculator.py  # Расчет по ФГОС
    │   ├── validators.py       # Валидация
    │   └── reports.py          # Генерация PDF
    └── management/
        └── commands/       # Django команды
```

---

## 5. Основные таблицы базы данных

```sql
-- 1. Пользователи
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(10) CHECK (role IN ('teacher', 'student')),
    full_name VARCHAR(255),
    college_id INTEGER,
    specialty_code VARCHAR(20),  -- 15.02.01
    group_name VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW()
);

-- 2. Предметы
CREATE TABLE subjects (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    code VARCHAR(20),  -- код по ФГОС
    specialty_code VARCHAR(20),
    teacher_id INTEGER REFERENCES users(id)
);

-- 3. Оценки (основная таблица)
CREATE TABLE grades (
    id SERIAL PRIMARY KEY,
    student_id INTEGER REFERENCES users(id),
    teacher_id INTEGER REFERENCES users(id),
    subject_id INTEGER REFERENCES subjects(id),
    
    -- Данные по ФГОС
    competency_code VARCHAR(20),  -- ПК 1.1, ОПК 2.3
    percentage INTEGER CHECK (percentage BETWEEN 0 AND 100),
    grade_value INTEGER CHECK (grade_value BETWEEN 2 AND 5),
    comment TEXT NOT NULL CHECK (LENGTH(comment) >= 100),
    
    -- Системные поля
    date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    
    -- Ограничение: 1 оценка в неделю
    CONSTRAINT one_grade_per_week UNIQUE 
        (student_id, subject_id, DATE_TRUNC('week', date))
);

-- 4. Компетенции ФГОС (справочник)
CREATE TABLE fgos_competencies (
    id SERIAL PRIMARY KEY,
    code VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(500),
    specialty_code VARCHAR(20),
    type VARCHAR(10)  -- ПК, ОПК, УК
);
```

---

## 6. Ключевые страницы приложения

### 6.1. Общедоступные:
1. **/login** - Страница входа
2. **/logout** - Выход из системы

### 6.2. Для студентов:
3. **/student/dashboard** - Главная страница
4. **/student/grades** - Все оценки
5. **/student/subjects** - Список предметов
6. **/student/report** - Отчет по успеваемости

### 6.3. Для преподавателей:
7. **/teacher/dashboard** - Панель преподавателя
8. **/teacher/groups** - Мои группы
9. **/teacher/grade/add** - Выставить оценку
10. **/teacher/reports** - Отчеты и аналитика

---

## 7. Бизнес-логика (основные функции)

### 7.1. Расчет оценки по ФГОС:
```python
def calculate_grade(percentage):
    """Преобразует процент в оценку по ФГОС"""
    if 86 <= percentage <= 100:
        return 5, "высокий уровень"
    elif 67 <= percentage <= 85:
        return 4, "повышенный уровень"
    elif 48 <= percentage <= 66:
        return 3, "базовый уровень"
    else:
        return 2, "не сформировано"
```

### 7.2. Проверка комментария:
```python
def validate_comment(comment, competency_code):
    """Проверяет комментарий на соответствие требованиям"""
    if len(comment) < 100:
        return False, "Комментарий должен быть не менее 100 символов"
    
    if competency_code not in comment:
        return False, f"Укажите код компетенции ({competency_code})"
    
    return True, "OK"
```

### 7.3. Расчет среднего балла:
```python
def calculate_average(student_id, subject_id=None):
    """Рассчитывает средний балл для студента"""
    # Простой расчет без весов (можно усложнить позже)
    grades = Grade.objects.filter(student_id=student_id)
    if subject_id:
        grades = grades.filter(subject_id=subject_id)
    
    if not grades.exists():
        return 0
    
    return sum(g.grade_value for g in grades) / len(grades)
```

---

## 8. Валидации и ограничения

### Автоматические проверки:
1. **Ролевой доступ** - студенты не могут выставлять оценки
2. **Ограничение оценок** - не более 1 оценки в неделю по предмету
3. **Минимум комментария** - 100 символов обязательно
4. **Код компетенции** - должен присутствовать в комментарии
5. **Процент освоения** - только 0-100%

### Бизнес-правила:
- Преподаватель видит только свои группы
- Студент видит только свои оценки
- Итоговая оценка - только если есть 4+ текущих
- Экспорт в PDF только для преподавателей

---

## 9. Развертывание и настройка

### Простой вариант (без Docker):
```bash
# 1. Установка зависимостей
pip install django psycopg2-binary pillow

# 2. Настройка базы данных
createdb edu_system

# 3. Миграции
python manage.py makemigrations
python manage.py migrate

# 4. Создание суперпользователя
python manage.py createsuperuser

# 5. Запуск
python manage.py runserver
```

### Вариант с Docker (рекомендуется):
```dockerfile
# docker-compose.yml
version: '3.8'
services:
  db:
    image: postgres:13
    environment:
      POSTGRES_DB: edu_system
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  web:
    build: .
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - .:/app
    ports:
      - "8000:8000"
    depends_on:
      - db
```

---

## 10. Этапы разработки (по неделям)

**Неделя 1:** Базовая настройка Django + модели БД  
**Неделя 2:** Система авторизации и роли  
**Неделя 3:** Личный кабинет студента (просмотр оценок)  
**Неделя 4:** Панель преподавателя (выставление оценок)  
**Неделя 5:** Валидации по ФГОС + расчеты  
**Неделя 6:** Отчеты и экспорт в PDF  
**Неделя 7:** Тестирование и фиксы  
**Неделя 8:** Деплой и документация  

---

## 11. Упрощения для учебного проекта

1. **Нет API** - только серверный рендеринг
2. **Нет микросервисов** - монолитная архитектура
3. **Простой фронтенд** - Bootstrap + немного JS
4. **Минимум зависимостей** - Django + PostgreSQL
5. **Без сложных интеграций** - всё в одном приложении
6. **Без real-time** - обновление страницы для новых данных
7. **Локальный деплой** - можно на одном сервере

---

## 12. Что можно добавить позже (если будет время)

1. **Уведомления** - email о новых оценках
2. **Импорт/экспорт** - Excel для массового ввода
3. **Графики** - визуализация успеваемости
4. **Поиск** - быстрый поиск студентов/оценок
5. **Бэкенд API** - если понадобится мобильное приложение

---

## Итог

Такая архитектура:
- ✅ **Простая** для понимания и разработки
- ✅ **Быстрая** в реализации (4-8 недель)
- ✅ **Соответствует всем требованиям** ФГОС СПО
- ✅ **Масштабируемая** (можно добавить API позже)
- ✅ **Идеальна для учебного проекта** - показывает все основные навыки

**Основной фокус:** работающая бизнес-логика по ФГОС, а не сложная архитектура.